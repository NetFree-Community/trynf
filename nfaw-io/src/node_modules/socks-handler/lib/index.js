var socks4, socks5;

socks4 = require('./socks4');

socks5 = require('./socks5');

exports.handle = function(stream, callback) {
  return stream.once('data', function(chunk) {
    var handler, version;
    switch (version = chunk[0]) {
      case socks4.VERSION:
        handler = socks4.createHandler();
        break;
      case socks5.VERSION:
        handler = socks5.createHandler();
        break;
      default:
        if (typeof callback === "function") {
          callback(new Error("Unsupported SOCKS version: " + version));
        }
        return;
    }
    stream.pipe(handler).pipe(stream);
    handler.on('success', function() {
      return stream.unpipe(handler).unpipe(stream);
    });
    callback(null, handler);
    return handler.write(chunk);
  });
};

exports[4] = socks4;

exports[5] = socks5;
